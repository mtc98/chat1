var K=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var k=(s,t,r)=>t in s?K(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,C=(s,t)=>{for(var r in t||(t={}))Y.call(t,r)&&k(s,r,t[r]);if(j)for(var r of j(t))Z.call(t,r)&&k(s,r,t[r]);return s},D=(s,t)=>W(s,X(t));import{f as E,r as o,j as e,a,L as U,u as _,S as M,b as Q,z as J,c as V,F as ee,N as $,H as te,R as se,d as S,e as F,g as re,h as ne}from"./vendor.a13ebbee.js";const ae=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function r(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerpolicy&&(u.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?u.credentials="include":n.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(n){if(n.ep)return;n.ep=!0;const u=r(n);fetch(n.href,u)}};ae();const ue={apiKey:"AIzaSyDSKgUwZ5b8ZNM_3MX36XOSwMi6IuXQGm8",authDomain:"mtc9820201216.firebaseapp.com",projectId:"mtc9820201216",storageBucket:"mtc9820201216.appspot.com",messagingSenderId:"356765302606",appId:"1:356765302606:web:22142c8f99b9abd6aea81f"};E.initializeApp(ue);const A=E.firestore(),x=E.auth(),le=E.storage(),w=E.firestore.Timestamp,q=o.exports.createContext(),oe=(s,t)=>{switch(t.type){case"LOGIN":return D(C({},s),{user:t.payload});case"LOGOUT":return D(C({},s),{user:null});case"AUTH_IS_READY":return{user:t.payload,authIsReady:!0};default:return s}},ce=({children:s})=>{const[t,r]=o.exports.useReducer(oe,{user:null,authIsReady:!1});return o.exports.useEffect(()=>{const l=x.onAuthStateChanged(n=>{r({type:"AUTH_IS_READY",payload:n}),l()})},[]),console.log("AuthContext state:",t),e(q.Provider,{value:D(C({},t),{dispatch:r}),children:s})},y=()=>{const s=o.exports.useContext(q);if(!s)throw Error("useAuthContext must be used inside an AuthContextProvider");return s};const I=(s,t,r)=>{const[l,n]=o.exports.useState(null),[u,d]=o.exports.useState(null),c=o.exports.useRef(t).current,i=o.exports.useRef(r).current;return o.exports.useEffect(()=>{let h=A.collection(s);c&&(h=h.where(...c)),i&&(h=h.orderBy(...i));const m=h.onSnapshot(f=>{let p=[];f.docs.forEach(b=>{p.push(D(C({},b.data()),{id:b.id}))}),n(p),d(null)},f=>{console.log(f),d("could not fetch the data")});return()=>m()},[s,c,i]),{documents:l,error:u}};function B({src:s}){return e("div",{className:"avatar",children:e("img",{src:s,alt:"user avatar"})})}function ie({projects:s}){return console.log(s),a("div",{className:"project-list",children:[s.length===0&&e("p",{children:"\u76EE\u524D\u6C92\u6709\u4EFB\u4F55\u5C08\u6848\u3002"}),s.map(t=>a(U,{to:`/projects/${t.id}`,children:[e("h4",{children:t.name}),a("p",{children:["\u7531 ",t.createdBy.displayName," \u5EFA\u7ACB"]}),a("p",{children:["\u622A\u6B62\u65E5\u671F\uFF1A",t.dueDate.toDate().toDateString()]}),a("div",{className:"assigned-to",children:[e("p",{children:e("strong",{children:"\u6307\u6D3E\u7D66\uFF1A"})}),e("ul",{children:t.assignedUsersList.map(r=>e("li",{children:e(B,{src:r.photoURL})},r.photoURL))})]})]},t.id))]})}const de=[{key:"all",label:"\u5168\u90E8"},{key:"mine",label:"\u6211\u7684\u5C08\u6848"},{key:"development",label:"\u958B\u767C"},{key:"design",label:"\u8A2D\u8A08"},{key:"marketing",label:"\u884C\u92B7"},{key:"sales",label:"\u696D\u52D9"}];function pe({changeFilter:s}){const[t,r]=o.exports.useState("all"),l=n=>{r(n),s(n)};return e("div",{className:"project-filter",children:a("nav",{children:[e("p",{children:"\u7BE9\u9078\uFF1A"}),de.map(n=>e("button",{onClick:()=>l(n.key),className:t===n.key?"active":"",children:n.label},n.key))]})})}function he(){const{user:s}=y(),{documents:t,error:r}=I("projects"),[l,n]=o.exports.useState("all"),u=c=>{n(c)},d=t?t.filter(c=>{switch(l){case"all":return!0;case"mine":let i=!1;return c.assignedUsersList.forEach(h=>{h.id===s.uid&&(i=!0)}),i;case"development":case"design":case"sales":case"marketing":return console.log(c.category,l),c.category===l;default:return!0}}):null;return a("div",{children:[e("h2",{className:"page-title",children:"\u5100\u8868\u677F"}),r&&e("p",{className:"error",children:r}),t&&e(pe,{changeFilter:u}),d&&e(ie,{projects:d})]})}let me={document:null,isPending:!1,error:null,success:null};const fe=(s,t)=>{switch(t.type){case"IS_PENDING":return{isPending:!0,document:null,success:!1,error:null};case"ADDED_DOCUMENT":return{isPending:!1,document:t.payload,success:!0,error:null};case"DELETED_DOCUMENT":return{isPending:!1,document:null,success:!0,error:null};case"ERROR":return{isPending:!1,document:null,success:!1,error:t.payload};case"UPDATED_DOCUMENT":return{isPending:!1,document:t.payload,success:!0,error:null};default:return s}},O=s=>{const[t,r]=o.exports.useReducer(fe,me),[l,n]=o.exports.useState(!1),u=A.collection(s),d=m=>{l||r(m)},c=async m=>{r({type:"IS_PENDING"});try{const f=w.fromDate(new Date),p=await u.add(D(C({},m),{createdAt:f}));d({type:"ADDED_DOCUMENT",payload:p})}catch(f){d({type:"ERROR",payload:f.message})}},i=async m=>{r({type:"IS_PENDING"});try{await u.doc(m).delete(),d({type:"DELETED_DOCUMENT"})}catch{d({type:"ERROR",payload:"could not delete"})}},h=async(m,f)=>{r({type:"IS_PENDING"});try{const p=await u.doc(m).update(f);return d({type:"UPDATED_DOCUMENT",payload:p}),p}catch(p){return d({type:"ERROR",payload:p}),null}};return o.exports.useEffect(()=>()=>n(!0),[]),{addDocument:c,deleteDocument:i,updateDocument:h,response:t}};const ge=[{value:"development",label:"\u958B\u767C"},{value:"design",label:"\u8A2D\u8A08"},{value:"sales",label:"\u696D\u52D9"},{value:"marketing",label:"\u884C\u92B7"}];function ve(){const s=_(),{addDocument:t,response:r}=O("projects"),{user:l}=y(),{documents:n}=I("userdojo"),[u,d]=o.exports.useState([]),[c,i]=o.exports.useState(""),[h,m]=o.exports.useState(""),[f,p]=o.exports.useState(""),[b,R]=o.exports.useState(""),[g,N]=o.exports.useState([]),[T,L]=o.exports.useState(null);return o.exports.useEffect(()=>{n&&d(n.map(v=>({value:D(C({},v),{id:v.id}),label:v.displayName})))},[n]),a("div",{className:"create-form",children:[e("h2",{className:"page-title",children:"\u5EFA\u7ACB\u65B0\u5C08\u6848"}),a("form",{onSubmit:async v=>{if(v.preventDefault(),L(null),!b){L("\u8ACB\u9078\u64C7\u4E00\u500B\u5C08\u6848\u985E\u5225\u3002");return}if(g.length<1){L("\u8ACB\u81F3\u5C11\u6307\u6D3E\u4E00\u4F4D\u4F7F\u7528\u8005\u3002");return}const G=g.map(P=>({displayName:P.value.displayName,photoURL:P.value.photoURL,id:P.value.id})),z={displayName:l.displayName,photoURL:l.photoURL,id:l.uid},H={name:c,details:h,assignedUsersList:G,createdBy:z,category:b.value,dueDate:w.fromDate(new Date(f)),comments:[]};await t(H),r.error||s("/")},children:[a("label",{children:[e("span",{children:"\u5C08\u6848\u540D\u7A31\uFF1A"}),e("input",{required:!0,type:"text",onChange:v=>i(v.target.value),value:c})]}),a("label",{children:[e("span",{children:"\u5C08\u6848\u8A73\u60C5\uFF1A"}),e("textarea",{required:!0,onChange:v=>m(v.target.value),value:h})]}),a("label",{children:[e("span",{children:"\u8A2D\u5B9A\u622A\u6B62\u65E5\u671F\uFF1A"}),e("input",{required:!0,type:"date",onChange:v=>p(v.target.value),value:f})]}),a("label",{children:[e("span",{children:"\u5C08\u6848\u985E\u5225\uFF1A"}),e(M,{onChange:v=>R(v),options:ge})]}),a("label",{children:[e("span",{children:"\u6307\u6D3E\u7D66\uFF1A"}),e(M,{onChange:v=>N(v),options:u,isMulti:!0})]}),e("button",{className:"btn",children:"\u65B0\u589E\u5C08\u6848"}),T&&e("p",{className:"error",children:T})]})]})}const ye=()=>{const[s,t]=o.exports.useState(!1),[r,l]=o.exports.useState(null),[n,u]=o.exports.useState(!1),{dispatch:d}=y(),c=async(i,h)=>{l(null),u(!0);try{const m=await x.signInWithEmailAndPassword(i,h);await A.collection("userdojo").doc(m.user.uid).update({online:!0}),d({type:"LOGIN",payload:m.user}),s||(u(!1),l(null))}catch(m){s||(l(m.message),u(!1))}};return o.exports.useEffect(()=>()=>t(!0),[]),{login:c,isPending:n,error:r}};function be(){const[s,t]=o.exports.useState(""),[r,l]=o.exports.useState(""),{login:n,error:u,isPending:d}=ye();return a("form",{onSubmit:i=>{i.preventDefault(),n(s,r)},className:"auth-form",children:[e("h2",{children:"\u767B\u5165"}),a("label",{children:[e("span",{children:"\u96FB\u5B50\u90F5\u4EF6:"}),e("input",{required:!0,type:"email",onChange:i=>t(i.target.value),value:s})]}),a("label",{children:[e("span",{children:"\u5BC6\u78BC:"}),e("input",{required:!0,type:"password",onChange:i=>l(i.target.value),value:r})]}),!d&&e("button",{className:"btn",children:"\u767B\u5165"}),d&&e("button",{className:"btn",disabled:!0,children:"\u767B\u5165\u4E2D..."}),u&&e("div",{className:"error",children:u})]})}const Ce=()=>{const[s,t]=o.exports.useState(!1),[r,l]=o.exports.useState(null),[n,u]=o.exports.useState(!1),{dispatch:d}=y(),c=async(i,h,m,f)=>{l(null),u(!0);try{const p=await x.createUserWithEmailAndPassword(i,h);if(!p)throw new Error("Could not complete signup");const b=`thumbnails/${p.user.uid}/${f.name}`,g=await(await le.ref(b).put(f)).ref.getDownloadURL();await p.user.updateProfile({displayName:m,photoURL:g}),await A.collection("userdojo").doc(p.user.uid).set({online:!0,displayName:m,photoURL:g,email:i}),d({type:"LOGIN",payload:p.user}),s||(u(!1),l(null))}catch(p){s||(l(p.message),u(!1))}};return o.exports.useEffect(()=>()=>t(!0),[]),{signup:c,error:r,isPending:n}};function De(){const[s,t]=o.exports.useState(""),[r,l]=o.exports.useState(""),[n,u]=o.exports.useState(""),[d,c]=o.exports.useState(null),[i,h]=o.exports.useState(null),{signup:m,isPending:f,error:p}=Ce();return a("form",{onSubmit:g=>{g.preventDefault(),m(s,r,n,d)},className:"auth-form",children:[e("h2",{children:"sign up"}),a("label",{children:[e("span",{children:"\u96FB\u5B50\u90F5\u4EF6:"}),e("input",{required:!0,type:"email",onChange:g=>t(g.target.value),value:s})]}),a("label",{children:[e("span",{children:"\u5BC6\u78BC:"}),e("input",{required:!0,type:"password",onChange:g=>l(g.target.value),value:r})]}),a("label",{children:[e("span",{children:"\u986F\u793A\u540D\u7A31:"}),e("input",{required:!0,type:"text",onChange:g=>u(g.target.value),value:n})]}),a("label",{children:[e("span",{children:"\u500B\u4EBA\u982D\u50CF:"}),e("input",{required:!0,type:"file",onChange:g=>{c(null);let N=g.target.files[0];if(console.log(N),!N){h("\u8ACB\u9078\u64C7\u4E00\u500B\u6A94\u6848");return}if(!N.type.includes("image")){h("\u9078\u64C7\u7684\u6A94\u6848\u5FC5\u9808\u662F\u5716\u7247");return}if(N.size>1e5){h("\u5716\u7247\u6A94\u6848\u5927\u5C0F\u5FC5\u9808\u5C0F\u65BC 100kb");return}h(null),c(N),console.log("\u982D\u50CF\u5DF2\u66F4\u65B0")}}),i&&e("div",{className:"error",children:i})]}),!f&&e("button",{className:"btn",children:"\u8A3B\u518A"}),f&&e("button",{className:"btn",disabled:!0,children:"\u8A3B\u518A\u4E2D..."}),p&&e("div",{className:"error",children:p})]})}const Ne=(s,t)=>{const[r,l]=o.exports.useState(null),[n,u]=o.exports.useState(null);return o.exports.useEffect(()=>{const c=A.collection(s).doc(t).onSnapshot(i=>{i.data()?(l(D(C({},i.data()),{id:i.id})),u(null)):u("No such document exists")},i=>{console.log(i.message),u("failed to get document")});return()=>c()},[s,t]),{document:r,error:n}};function Ae({project:s}){const{user:t}=y(),{updateDocument:r,response:l}=O("projects"),[n,u]=o.exports.useState(""),d=async c=>{c.preventDefault();const i={displayName:t.displayName,photoURL:t.photoURL,content:n,createdAt:w.fromDate(new Date),id:Math.random()};await r(s.id,{comments:[...s.comments,i]}),l.error||u("")};return a("div",{className:"project-comments",children:[e("h4",{children:"\u5C08\u6848\u7559\u8A00"}),e("ul",{children:s.comments.length>0&&s.comments.map(c=>a("li",{children:[a("div",{className:"comment-author",children:[e(B,{src:c.photoURL}),a("p",{children:[" ",c.displayName," "]})]}),e("div",{className:"comment-date",children:e("p",{children:Q(c.createdAt.toDate(),{addSuffix:!0,locale:J})})}),e("div",{className:"comment-content",children:a("p",{children:[" ",c.content]})})]},c.id))}),a("form",{className:"add-comment",onSubmit:d,children:[a("label",{children:[e("span",{children:"\u65B0\u589E\u7559\u8A00\uFF1A"}),e("textarea",{onChange:c=>u(c.target.value),value:n})]}),e("button",{className:"btn",children:"\u65B0\u589E\u7559\u8A00"})]})]})}function Ee({project:s}){const{deleteDocument:t}=O("projects"),{user:r}=y(),l=_(),n=()=>{t(s.id),l("/")};return a("div",{children:[a("div",{className:"project-summary",children:[e("h2",{className:"page-title",children:s.name}),a("p",{children:["\u7531 ",s.createdBy.displayName," \u5EFA\u7ACB"]}),a("p",{className:"due-date",children:["\u5C08\u6848\u622A\u6B62\u65E5\u671F\uFF1A",s.dueDate.toDate().toDateString()]}),e("p",{className:"details",children:s.details}),e("h4",{children:"\u5C08\u6848\u6307\u6D3E\u7D66\uFF1A"}),e("div",{className:"assigned-users",children:s.assignedUsersList.map(u=>e("div",{children:e(B,{src:u.photoURL})},u.id))})]}),r.uid===s.createdBy.id&&e("button",{className:"btn",onClick:n,children:"\u6A19\u793A\u70BA\u5DF2\u5B8C\u6210"})]})}function Se(){const{id:s}=V(),{document:t,error:r}=Ne("projects",s);return r?e("div",{className:"error",children:r}):t?a("div",{className:"project-details",children:[e(Ee,{project:t}),e(Ae,{project:t})]}):e("div",{className:"loading",children:"Loading..."})}const Fe=()=>{const[s,t]=o.exports.useState(!1),[r,l]=o.exports.useState(null),[n,u]=o.exports.useState(!1),{dispatch:d}=y(),c=async()=>{l(null),u(!0);try{const{uid:i}=x.currentUser;await A.collection("userdojo").doc(i).update({online:!1}),await x.signOut(),d({type:"LOGOUT"}),s||(u(!1),l(null))}catch(i){s||(l(i.message),u(!1))}};return o.exports.useEffect(()=>()=>t(!0),[]),{logout:c,error:r,isPending:n}};var xe="/assets/temple.b2ce776b.svg";function Be(){const{logout:s,isPending:t}=Fe(),{user:r}=y();return e("nav",{className:"navbar",children:a("ul",{children:[a("li",{className:"logo",children:[e("img",{src:xe,alt:"dojo logo"}),e("span",{children:"The Dojo"})]}),!r&&a(ee,{children:[e("li",{children:e(U,{to:"/login",children:"\u767B\u5165"})}),e("li",{children:e(U,{to:"/signup",children:"\u8A3B\u518A"})})]}),r&&a("li",{children:[!t&&e("button",{className:"btn",onClick:s,children:"\u767B\u51FA"}),t&&e("button",{className:"btn",disabled:!0,children:"\u767B\u51FA\u4E2D..."})]})]})})}var Re="/assets/dashboard_icon.4498f14e.svg",Le="/assets/add_icon.2ced1ca4.svg";function Pe(){const{user:s}=y();return e("div",{className:"sidebar",children:a("div",{className:"sidebar-content",children:[a("div",{className:"user",children:[e(B,{src:s.photoURL}),a("p",{children:[" \u55E8 ! ",s.displayName]})]}),e("nav",{className:"links",children:a("ul",{children:[e("li",{children:a($,{exact:!0,to:"/",children:[e("img",{src:Re,alt:"\u5100\u8868\u677F\u5716\u793A"}),e("span",{children:"\u4F48\u544A\u6B04"})]})}),e("li",{children:a($,{to:"/create",children:[e("img",{src:Le,alt:"\u65B0\u589E\u5C08\u6848\u5716\u793A"}),e("span",{children:"\u65B0\u589E\u5C08\u6848"})]})})]})})]})})}function Ue(){const{isPending:s,error:t,documents:r}=I("userdojo");return a("div",{className:"user-list",children:[e("h2",{children:"All Users"}),s&&e("div",{children:"Loading users..."}),t&&e("div",{children:t}),r&&r.map(l=>a("div",{className:"user-list-item",children:[l.online&&e("span",{className:"online-user"}),e("span",{children:l.displayName}),e(B,{src:l.photoURL})]},l.id))]})}function we(){const{authIsReady:s,user:t}=y();return e("div",{className:"App",children:s&&a(te,{children:[t&&e(Pe,{}),a("div",{className:"container",children:[e(Be,{}),a(se,{children:[e(S,{path:"/",element:t?e(he,{}):e(F,{to:"/login"})}),e(S,{path:"/create",element:t?e(ve,{}):e(F,{to:"/login"})}),e(S,{path:"/projects/:id",element:t?e(Se,{}):e(F,{to:"/login"})}),e(S,{path:"/login",element:t?e(F,{to:"/"}):e(be,{})}),e(S,{path:"/signup",element:t?e(F,{to:"/"}):e(De,{})})]})]}),t&&e(Ue,{})]})})}re.render(e(ne.StrictMode,{children:e(ce,{children:e(we,{})})}),document.getElementById("root"));
